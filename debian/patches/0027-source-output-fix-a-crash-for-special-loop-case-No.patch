From 109535cf8b41c08108190024448fffadafb9a08b Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Marc-Andr=C3=A9=20Lureau?= <marcandre.lureau@gmail.com>
Date: Thu, 4 Dec 2008 16:23:41 +0200
Subject: [PATCH] source-output: fix a crash for special loop case (Nokia specific)

---
 src/pulsecore/source-output.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/src/pulsecore/source-output.c b/src/pulsecore/source-output.c
index 7adc757..c409d89 100644
--- a/src/pulsecore/source-output.c
+++ b/src/pulsecore/source-output.c
@@ -611,6 +611,11 @@ int pa_source_output_move_to(pa_source_output *o, pa_source *dest) {
     if (o->flags & PA_SOURCE_OUTPUT_DONT_MOVE)
         return -1;
 
+    if (dest->asyncmsgq == o->source->asyncmsgq) {
+        pa_log_warn("Moving streams to slaved source ""%s"" not supported.", dest->name);
+        return -1;
+    }
+
     if (o->direct_on_input)
         return -1;
 
-- 
1.6.0.2.514.g23abd3

