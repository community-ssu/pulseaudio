From 74f0aceed66feba4b59ebf2a6aeb7f0b47e6c54b Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Marc-Andr=C3=A9=20Lureau?= <marc-andre.lureau@nokia.com>
Date: Tue, 10 Mar 2009 18:01:44 +0200
Subject: [PATCH 59/68] pulsecore: forward flat_volume functions to flat_volume_sink

btw, pa_sink_propagate_flat_volume() could be static... in that case,
we could make sure it's not called with a slaved sink.
---
 src/pulsecore/sink.c |   13 +++++++++++++
 1 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/src/pulsecore/sink.c b/src/pulsecore/sink.c
index 2796c2b..653e160 100644
--- a/src/pulsecore/sink.c
+++ b/src/pulsecore/sink.c
@@ -1193,6 +1193,13 @@ void pa_sink_update_flat_volume(pa_sink *s, pa_cvolume *new_volume) {
      * the sinks volume here, we only return how it needs to be
      * updated. The caller should then call pa_sink_set_volume().*/
 
+    if (s->flat_volume_sink) {
+        /* this sink is flatten with flat_volume_sink */
+        pa_sink_update_flat_volume(s->flat_volume_sink, new_volume);
+        pa_cvolume_remap(new_volume, &s->flat_volume_sink->channel_map, &s->channel_map);
+        return;
+    }
+
     if (pa_idxset_isempty(s->inputs)) {
         /* In the special case that we have no sink input we leave the
          * volume unmodified. */
@@ -1268,6 +1275,12 @@ void pa_sink_propagate_flat_volume(pa_sink *s) {
     /* This is called whenever the sink volume changes that is not
      * caused by a sink input volume change. We need to fix up the
      * sink input volumes accordingly */
+    if (s->flat_volume_sink) {
+        /* this sink is flatten with flat_volume_sink */
+        pa_sink_propagate_flat_volume(s->flat_volume_sink);
+        return;
+    }
+
     propagate_flat_volume(s, s);
 }
 
-- 
1.6.3.1

