From c0494de8ca88d4a9fd2bafe5914c78355ef0b254 Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jyri.sarha@nokia.com>
Date: Thu, 23 Jul 2009 12:13:40 +0300
Subject: [PATCH] flat-sink: Fix pa_sink_set_volume (add volume remapping)

---
 src/pulsecore/sink.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/src/pulsecore/sink.c b/src/pulsecore/sink.c
index 30a61c2..1505317 100644
--- a/src/pulsecore/sink.c
+++ b/src/pulsecore/sink.c
@@ -1364,18 +1364,20 @@ static pa_bool_t sink_set_volume(pa_sink *s, const pa_cvolume *v, const pa_chann
 
 /* Called from main thread */
 void pa_sink_set_volume(pa_sink *s, const pa_cvolume *volume, pa_bool_t propagate, pa_bool_t sendmsg, pa_bool_t become_reference) {
+    const pa_channel_map *channel_map;
     pa_sink_assert_ref(s);
     pa_assert(PA_SINK_IS_LINKED(s->state));
     pa_assert(volume);
     pa_assert(pa_cvolume_valid(volume));
     pa_assert(pa_cvolume_compatible(volume, &s->sample_spec));
 
+    channel_map = &s->channel_map;
     /* go to the root-sink of the sinks, beware volume is not remapped */
     while (s->flat_volume_sink)
         s = s->flat_volume_sink;
 
     /* Propagate this volume change back to the inputs */
-    if (sink_set_volume(s, volume, &s->channel_map, become_reference))
+    if (sink_set_volume(s, volume, channel_map, become_reference))
         if (propagate && (s->flags & PA_SINK_FLAT_VOLUME))
             pa_sink_propagate_flat_volume(s);
 
-- 
1.5.6.3

