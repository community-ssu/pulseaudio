From 6278dc8e228e9bf83e50bda6589f64a14a900485 Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Marc-Andr=C3=A9=20Lureau?= <marc-andre.lureau@nokia.com>
Date: Tue, 17 Feb 2009 17:04:09 +0200
Subject: [PATCH 24/27] bluetooth: do not call stop_stream_fd if no rtpoll_item

---
 src/modules/bluetooth/module-bluetooth-device.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/modules/bluetooth/module-bluetooth-device.c b/src/modules/bluetooth/module-bluetooth-device.c
index 6378933..d632c3b 100644
--- a/src/modules/bluetooth/module-bluetooth-device.c
+++ b/src/modules/bluetooth/module-bluetooth-device.c
@@ -760,7 +760,8 @@ static int sink_process_msg(pa_msgobject *o, int code, void *data, int64_t offse
                 case PA_SINK_SUSPENDED:
                     pa_assert(PA_SINK_IS_OPENED(u->sink->thread_info.state));
 
-                    stop_stream_fd(u, PA_OBJECT(u->sink)); /* FIXME: return value */
+                    if (u->rtpoll_item != NULL)
+                        stop_stream_fd(u, PA_OBJECT(u->sink)); /* FIXME: return value */
 
                     break;
 
@@ -805,7 +806,8 @@ static int source_process_msg(pa_msgobject *o, int code, void *data, int64_t off
             switch ((pa_source_state_t) PA_PTR_TO_UINT(data)) {
 
                 case PA_SOURCE_SUSPENDED:
-                    stop_stream_fd(u, PA_OBJECT(u->source)); /* FIXME: return value */
+                    if (u->rtpoll_item != NULL)
+                        stop_stream_fd(u, PA_OBJECT(u->source)); /* FIXME: return value */
                     pa_smoother_pause(u->read_smoother, pa_rtclock_usec());
                     break;
 
-- 
1.6.1.224.gb56c

